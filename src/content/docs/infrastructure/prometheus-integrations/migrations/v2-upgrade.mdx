---
title: Upgrade to version 2
tags:
    - Integrations
    - Prometheus integration v2
    - Changelog
metaDescription: Upgrade to v2
redirects: []
freshnessValidatedDate: 2025-05-29
---

`v2` of the Prometheus integration requires the use of [Prometheus v3](https://prometheus.io/blog/2024/11/14/prometheus-3-0/). As such, any [breaking changes](https://prometheus.io/docs/prometheus/latest/migration) made in Prometheus `v3` may also be present in `v2` of this agent. Specifically, Prometheus v3 is more [strict](https://prometheus.io/docs/prometheus/latest/migration/#scrape-protocols) concerning the `Content-Type` header received when scraping. While Prometheus v2 would default to the standard Prometheus text protocol if the header was missing or invalid, Prometheus v3 will now fail the scrape.

As a result, the following changes need to be made:

- Both default Kubernetes jobs now need `fallback_scrape_protocol: "PrometheusText0.0.4"` added to their spec. The default jobs for `config.kubernetes.jobs` should look as follows:
```yaml
- job_name_prefix: default
  fallback_scrape_protocol: "PrometheusText0.0.4"
  target_discovery:
    pod: true
    endpoints: true
    filter:
      annotations:
        prometheus.io/scrape: true
- job_name_prefix: newrelic
  fallback_scrape_protocol: "PrometheusText0.0.4"
  integrations_filter:
    enabled: false
  target_discovery:
    pod: true
    endpoints: true
    filter:
      annotations:
        newrelic.io/scrape: true
```
- Any custom `config.static_targets.jobs` that target a Prometheus endpoint with missing or invalid headers would need to be fixed to have a valid header, or as a temporary solution, `fallback_scrape_protocol: "PrometheusText0.0.4"` can be added to their spec.
- Any custom `config.extra_scrape_configs` that target a Prometheus endpoint with missing or invalid headers would need to be fixed to have a valid header, or as a temporary solution, `fallback_scrape_protocol: "PrometheusText0.0.4"` can be added to their spec.

<Callout variant="important">
  The `--reuse-values` flag is not supported if you upgrade from v1 to v2.
</Callout>
