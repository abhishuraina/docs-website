---
title: "Containerized instrumentation"
metaDescription: "A guide for instrumenting your containerized image layer with New Relic."
tags:
  - Azure Functions
  - Kubernetes
  - Docker
  - Containerized Functions
  - Containerized Functions monitoring
  - Azure Functions monitoring
  - Instrumentation
  - Configuration
  - New Relic .NET Agent
  - New Relic Azure Websites Extension
  - Environment Variables
  - Dockerfile
  - Containerized Functions 
freshnessValidatedDate: never
---


If you are using a containerized Azure Function, you can monitor your Azure Functions with the New Relic .NET agent, Python agent, or Node.js agent. This allows you to monitor the performance and health of your Azure Functions in real-time. 


<Steps>

<Step>

## Prerequisites [#begin]

* Ensure that your Azure Function meets our [compatibility and requirements](/docs/serverless-function-monitoring/azure-function-monitoring/compatibility-requirement-azure-monitoring).
* Link your Azure account to New Relic. For more information, refer to [Azure integration](/docs/infrastructure/microsoft-azure-integrations/azure-integrations-list/azure-functions-monitoring-integration/#polling).

</Step>

<Step>

## Configure Azure Functions monitoring

You can configure Azure Functions monitoring for different environments and various combinations of runtimes and deployment methods:

<Tabs>
  <TabsBar>
    <TabsBarItem id="net">.NET</TabsBarItem>
    <TabsBarItem id="node">NodeJS</TabsBarItem>
    <TabsBarItem id="python">Python</TabsBarItem>
  </TabsBar>

  <TabsPages>

    <TabsPageItem id="net">

    To install the New Relic .NET agent, add the following lines to the final stage of your Docker file:

    ```dockerfile
    # Install the latest New Relic .NET agent using the apt-get package manager
    # To install a specific version of the .NET agent, add the version number to the apt-get install line (i.e. apt-get install -y newrelic-dotnet-agent=10.38.0)
    RUN apt-get update && apt-get install -y wget ca-certificates gnupg \
        && echo 'deb http://apt.newrelic.com/debian/ newrelic non-free' | tee /etc/apt/sources.list.d/newrelic.list \
        && wget https://download.newrelic.com/548C16BF.gpg \
        && apt-key add 548C16BF.gpg \
        && apt-get update \
        && apt-get install -y newrelic-dotnet-agent \
        && rm -rf /var/lib/apt/lists/*
    ```
    
    When you deploy your application, the .NET agent is installed in the `/usr/local/newrelic-dotnet-agent` folder.
  
    </TabsPageItem>

    <TabsPageItem id="node">
    
To install the New Relic Node.js agent:

1. Edit your Function file to add the following code at the top of your function file:

  ```bash
    ENV NEW_RELIC_LICENSE_KEY=”your New Relic license key”
    ENV NEW_RELIC_APP_NAME=”your application name”
    # ENV NEW_RELIC_HOST='staging-collector.newrelic.com' 
    # Uncomment the previous line if using staging


    # Inject the agent in NODE_OPTIONS
    ENV NODE_OPTIONS=”-r newrelic”


    # Install New Relic without bin links
    ARG AGENT_VERSION=latest
    RUN npm install newrelic@${AGENT_VERSION} --no-bin-links
  ```

2. Build your Docket image as per your platform requirements:

  ```bash
    docker buildx build --platform=linux/amd64 --tag <YOUR_DOCKER_ID>/azurefunctionsimage:v1.0.0 --push .
  ```

3. Push your image to the Azure Container Registry:

1. Authenticate to your Azure Container Registry:

  ```bash
    az acr login --name <YOUR_CONTAINER_REGISTRY_NAME>
  ```

2. Tag your image with the Azure Container Registry URL:

  ```bash
  docker tag <YOUR_DOCKER_ID>/azurefunctionsimage:v1.0.0 <YOUR_LOGIN_SERVER>/azurefunctionsimage:v1.0.0
  ```

3. Push your image to the Azure Container Registry:

  ```bash
  docker push <YOUR_LOGIN_SERVER>/azurefunctionsimage:v1.0.0
  ```

4. Create the required Azure resources for your Azure Function App using the [Azure documentation.](https://learn.microsoft.com/en-us/azure/azure-functions/functions-deploy-container-apps?tabs=acr%2Cbash&pivots=programming-language-javascript#create-supporting-azure-resources-for-your-function).

5. Create and configure the Azure Function App using the image you pushed to the Azure Container Registry in the previous step. For more information, refer to the [Azure documentation](https://learn.microsoft.com/en-us/azure/azure-functions/functions-deploy-container-apps?tabs=acr%2Cbash&pivots=programming-language-javascript#create-and-configure-a-function-app-on-azure-with-the-image).

6. Retrieve the Azure Function App URL using the following command:

  ```bash
  az functionapp show --name <YOUR_APPLICATION_NAME> --resource-group <NAME_OF_THE_APPS_RESOURCE_GROUP>
  ```

    </TabsPageItem>

    <TabsPageItem id="python">
    
    NOT supported

    </TabsPageItem>
    
  </TabsPages>
</Tabs>

</Step>

<Step>

## Configure environment variables

After you've instrumented your Azure Function with the New Relic .NET Agent, configure environment variables:

  1. Navigate to your Azure Function in the Azure portal.
  2. Under **Settings**, click **Environment variables**, and then click **Advanced edit**.
  3. Based on your deployment environment, paste the following values:

<Callout variant="important">
Ensure that you add a comma at the end of the last existing line and update your license key in the following configurations.
</Callout>

<Tabs>
  <TabsBar>
    
    <TabsBarItem id=".net">.NET</TabsBarItem>
    <TabsBarItem id="node">NodeJS</TabsBarItem>
    <TabsBarItem id="python">Python</TabsBarItem>

  </TabsBar>

  <TabsPages>

  <TabsPageItem id=".net">

  ```json
  {
    "name": "CORECLR_ENABLE_PROFILING",
    "value": "1",
    "slotSetting": false
  },
  {
    "name": "CORECLR_NEW_RELIC_HOME",
    "value": "/usr/local/newrelic-dotnet-agent",
    "slotSetting": false
  },
  {
    "name": "CORECLR_PROFILER",
    "value": "{36032161-FFC0-4B61-B559-F6C5D41BAE5A}",
    "slotSetting": false
  }, 
  {
    "name": "CORECLR_PROFILER_PATH",
    "value": "/usr/local/newrelic-dotnet-agent/libNewRelicProfiler.so",
    "slotSetting": false
  },
  {
    "name": "NEW_RELIC_LOG_DIRECTORY",
    "value": "/home/LogFiles/NewRelic",
    "slotSetting": false
  },
  {
    "name": "NEW_RELIC_LICENSE_KEY",
    "value": "<your newrelic license key here>",
    "slotSetting": false
  }
  ```

  </TabsPageItem>

  <TabsPageItem id="node">

    Information required

  </TabsPageItem>

  <TabsPageItem id="python">

    Information required

  </TabsPageItem>

  </TabsPages>

</Tabs>

</Step>

<Step>

## Restart your Azure Function

After you've added the environment variables, restart your Azure Function to apply the changes.

</Step>

</Steps>

## What's next

After you complete the installation and configuration steps, send traffic to your Azure Function to see the metrics in the New Relic UI dashboard.
