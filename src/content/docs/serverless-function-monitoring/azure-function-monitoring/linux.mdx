---
title: "Linux instrumentation"
metaDescription: "Configure your Azure Functions with New Relic for Linux"
tags:
  - Azure Functions
  - Linux
  - Instrumentation
  - Configuration
  - New Relic .NET Agent
  - New Relic Python Agent
  - New Relic Node.js Agent
  - New Relic Azure Websites Extension
  - Environment Variables
freshnessValidatedDate: never
---

You can configure Azure Functions monitoring for Linux by instrumenting your Azure Function with the New Relic .NET agent, Python agent, or Node.js agent. This allows you to monitor the performance and health of your Azure Functions in real-time.

<Steps>

<Step>

## Prerequisites [#begin]

* Ensure that your Azure Function meets our [compatibility and requirements](/docs/serverless-function-monitoring/azure-function-monitoring/compatibility-requirement-azure-monitoring).
* Link your Azure account to New Relic. For more information, refer to [Azure integration](/docs/infrastructure/microsoft-azure-integrations/azure-integrations-list/azure-functions-monitoring-integration/#polling).

</Step>

<Step>

## Configure Azure Functions monitoring

You can configure Azure Functions monitoring for different environments and various combinations of runtimes and deployment methods:

<Tabs>
  <TabsBar>
    <TabsBarItem id="node">Node.js</TabsBarItem>
    <TabsBarItem id="net">.NET</TabsBarItem>
    <TabsBarItem id="python">Python</TabsBarItem>
  </TabsBar>

  <TabsPages>



    <TabsPageItem id="node">
    

    1. In the root directory of your Node.js Azure Function App project, install the agent as a standard dependency:
    
        ```node
        npm i newrelic
        ```
    2. To set the `SCM_DO_BUILD_DURING_DEPLOYMENT` to `true` in your application settings to install dependency in the deployment package, run:

        ```node
        az functionapp config appsettings set --name {NAME_OF_YOUR_AZURE_FUNCTION_APP} --settings SCM_DO_BUILD_DURING_DEPLOYMENT=true
        ```
    
    3. Publish your Azure Function App using the Azure CLI or your preferred publishing mechanism. You can use one of the following command to publish your Azure Function App:

        ```node
        func azure functionapp publish {NAME_OF_YOUR_AZURE_FUNCTION_APP}
        ```
        OR

        ```node
        az functionapp app up
        ```
        
        OR
        
        ```node
        az functionapp deploy
        ```

      <Callout variant="important">
        The above commands requires Azure-specific settings such as such as OS, Node version, Azure resource group, Azure subscription, Azure storage account, Azure region, and so on. Refer the Azure documentation to configure these settings.
      </Callout>



    </TabsPageItem>

    <TabsPageItem id="net">

    1. Add the latest version of the `NewRelic.Agent` NuGet package to your application project.
    2. Use your preferred publishing mechanism to deploy your updated application to Azure. 
    
    
    When you deploy your application, the .NET agent is installed in the `/home/site/wwwroot/newrelic` folder.
    
    </TabsPageItem>

    <TabsPageItem id="python">
    
    1. Add the latest version of the [`New Relic Python agent`](/docs/apm/agents/python-agent/getting-started/introduction-new-relic-python/) to your application project.
    2. In the root directory of your Python Azure Function App project, open the `requirements.txt` file.
    3. Add the following line in the `requirements.txt` file to install the New Relic agent for Azure Function instrumentation:
        
        ```bash
          git+https://github.com/newrelic/newrelic-python-agent.git@azure-function-instrumentation
        ```
    4. Initialize and register the New Relic agent in your Azure Function code using one of the following methods:
        1. **Option 1:** Manually updating the `function_app.py` file:
            1. Open the your `function_app.py` file in your Azure Function project.
            2. Add the following code to the top of the file to import the New Relic agent:
            
              ```python
              import newrelic.agent
              ```
            3. Initialize the New Relic agent. For more information, refer to [Initialize Python agent.](/docs/apm/agents/python-agent/python-agent-api/initialize-python-agent-api/)
            4. Register the New Relic agent with your Azure Function. For more information, refer to [Register Python agent.](/docs/apm/agents/python-agent/python-agent-api/registerapplication-python-agent-api/)

              <Callout variant="important">
                While registering the New Relic agent, ensure that you set the application name `NEW_RELIC_APP_NAME` or `WEBSITE_SITE_NAME` to the name of your Azure Function App. 

              </Callout>

              Your `function_app.py` file should look like this:

              ```python

                import newrelic.agent
                import os
                import azure.functions as func
                ...
                newrelic.agent.initialize()
                app_name = os.environ.get("NEW_RELIC_APP_NAME", \
                os.environ.get("WEBSITE_SITE_NAME", None))
                newrelic.agent.register_application(app_name)
                ...
                # Code here

              ```
        2. **Option 2:** Using New Relic provided following one-time script:
            1. In the root directory of your Python Azure Function App project, create a new file named `initialization.sh`.
            2. Add the following code to the `initialization.sh` file:
            
              ```bash
                #!/bin/bash
                # initialization.sh

                #####################################################################
                #
                # This one-time use script does the following tasks:
                # 1. Creates a new function_app.py file with New Relic  
                #   initialization and registration
                # 2. Moves the original function_app.py file into a directory
                #   called "original" 
                # 3. Adds the "original" directory into the .funcignore file
                #   so that there is no duplication of published files
                #
                #####################################################################

                mkdir original
                mv function_app.py ./original/

                echo -e 'import newrelic.agent\nimport os\n\nnewrelic.agent.initialize()\napp_name = os.environ.get("NEW_RELIC_APP_NAME", os.environ.get("WEBSITE_SITE_NAME", None))\nnewrelic.agent.register_application(app_name)\n' | cat - ./original/function_app.py > function_app.py

                echo 'original' >> .funcignore
              ```
            3. Save the `initialization.sh` file.
            4. Provide the permission to execute the script:
            
              ```bash
              chmod 755 initialization.sh
              ```
            5. Run the script:
            
              ```bash
              ./initialization.sh
              ```
    5. Publish your Azure Function App using the Azure CLI or your preferred publishing mechanism. You can use the following command to publish your Azure Function App:
    
        ```bash
        func azure functionapp publish \ ${NAME_OF_YOUR_AZURE_FUNCTION_APP}
        ```

    </TabsPageItem>
    
  </TabsPages>
</Tabs>

</Step>

<Step>

## Configure environment variables

After you've published the Azure Function app, configure environment variables:

  1. Navigate to your Azure Function in the Azure portal.
  2. Under **Settings**, click **Environment variables**, and then click **Advanced edit**.
  3. Based on your deployment runtime, paste the following values:

<Callout variant="important">
Ensure that you add a comma at the end of the last existing line and update your license key in the following configurations.
</Callout>

<Tabs>
  <TabsBar>
    
    <TabsBarItem id="nodejs">Node.js</TabsBarItem>
    <TabsBarItem id=".net">.NET</TabsBarItem>
    <TabsBarItem id="py">Python</TabsBarItem>

  </TabsBar>

  <TabsPages>


  <TabsPageItem id="nodejs">

  ```json
  {
    Information required for Node.js agent
  }
  ```

  </TabsPageItem>

  <TabsPageItem id=".net">

  ```json
  {
    "name": "CORECLR_ENABLE_PROFILING",
    "value": "1",
    "slotSetting": false
  },
  {
    "name": "CORECLR_NEW_RELIC_HOME",
    "value": "/home/site/wwwroot/newrelic",
    "slotSetting": false
  },
  {
    "name": "CORECLR_PROFILER",
    "value": "{36032161-FFC0-4B61-B559-F6C5D41BAE5A}",
    "slotSetting": false
  }, 
  {
    "name": "CORECLR_PROFILER_PATH",
    "value": "/home/site/wwwroot/newrelic/libNewRelicProfiler.so",
    "slotSetting": false
  },
  {
    "name": "NEW_RELIC_LOG_DIRECTORY",
    "value": "/home/LogFiles/NewRelic",
    "slotSetting": false
  },
  {
    "name": "NEW_RELIC_LICENSE_KEY",
    "value": "<your newrelic license key here>",
    "slotSetting": false
  }
  ```
  </TabsPageItem>

  <TabsPageItem id="py">

  ```json
  {
   Information required for Python agent
  }
  ```

  </TabsPageItem>

  </TabsPages>

</Tabs>

</Step>

<Step>

## Restart your Azure Function

After you've added the environment variables, restart your Azure Function to apply the changes.
</Step>

</Steps>

## What's next

After you complete the installation and configuration steps, send traffic to your Azure Function to see the metrics in the New Relic UI dashboard.
