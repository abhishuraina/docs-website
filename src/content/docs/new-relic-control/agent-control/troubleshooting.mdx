---
title: "Troubleshoot common issues"
metaDescription: "Learn how to diagnose and resolve common problems with Agent Control setup."
freshnessValidatedDate: never
---

<Callout title="preview">
  We're still working on this feature, but we'd love for you to try it out!

  This feature is currently provided as part of a preview program pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>
This document covers the steps to troubleshoot common issues during the installation or operation of Agent Control.

To diagnose errors during the installation process, adjust the log level for Agent Control by adding the following setting in your values-newrelic.yaml file:

```yaml
agent-control-deployment:
  config:
    agentControl:
      content:  
        log:
          level: trace
```

- **Default log level:** The default log level is `info`.
- **Supported log levels:** Other supported log levels are `debug` and `trace`.
- **OTel collector debug logs:** To enable debug logs in the OpenTelemetry collector, add `verboseLog: true`.

To read the logs, run the following command, making sure to adapt the command to reference the proper pod name and identifier:

```shell
kubectl logs agent-control-*** -n agent-control
```

## Status endpoint
Agent Control exposes a local status endpoint. Used to understand the health of Agent Control and of managed agents. The endpoint is enabled by default on port `52100`. Follow these steps to query the cluster status:

Forward a local port to the main agent-control pod:
```shell
kubectl port-forward <pod-name> 51200:51200
```
Request the agent status:
```shell
curl localhost:51200/status
```
## Helm release failure
Agent Control requires a valid authentication credential to securely connect to Fleet Control. Initially, this credential is automatically generated through the Agent Control installation UI and is represented by the `identityClientId` and `identityClientSecret` fields in the values file.

For security reasons, the credential necessary for installing Agent Control expires after 12 hours. If the installation fails with the error message below, follow these troubleshooting steps:
```shell
Error: UPGRADE FAILED: pre-upgrade hooks failed: job failed: BackoffLimitExceeded
```

Check the logs of the Kubernetes job in charge of setting up the credential:

First, identify the job’s pods:
```shell
kubectl describe job agent-control-system-identity -n <your-namespace>
```

The Events section will point to the specific pods, as follows:
```shell
Events:
      Type     Reason                Age   From            Message
      ----     ------                ----  ----            -------
      Normal   SuccessfulCreate      88s   job-controller  Created pod: agent-control-system-identity-installer-jr6cg
      Normal   SuccessfulCreate      73s   job-controller  Created pod: agent-control-system-identity-installer-wnx2v
      Normal   SuccessfulCreate      50s   job-controller  Created pod: agent-control-system-identity-installer-8zsqd
      Normal   SuccessfulCreate      7s    job-controller  Created pod: agent-control-system-identity-installer-btqh7
      Warning  BackoffLimitExceeded  1s    job-controller  Job has reached the specified backoff limit
```

You can view the logs of the corresponding pods as follows:
```shell
kubectl logs <pod-name> -n <your-namespace>
```

Here's an example:
```shell
kubectl logs agent-control-system-identity-installer-btqh7 -n newrelic
```

Retry the installation via Helm and check the logs. Here're some known issues:

- **Invalid `identityClientId`:** `Error getting system identity auth token. The API endpoint returned 404: Failed to find Identity: <identityClientId-value>`
- **Invalid `identityClientSecret`:** `Error getting system identity auth token. The API endpoint returned 400: Bad client secret.`
- **Identity expired:** `Error getting system identity auth token. The API endpoint returned 400: Expired client secret.`
- **Missing required permissions:** `Failed to create a New Relic System Identity for Fleet Control communication authentication. Please verify that your User Key is valid and that your Account Organization has the necessary permissions to create a System Identity: Exception while fetching data (/create) : Not authorized to perform this action or the entity is not found.`

## Invalid New Relic license
If you see an error message in the OpenTelemetry collector deployment pod similar to the following, you may have set an invalid license key, causing the collector to be unable to export data to New Relic:

```shell
2024-06-13T13:46:05.898Z error exporterhelper/retry_sender.go:126 Exporting failed. The error is not retryable. Dropping data. {"kind": "exporter", "data_type": "metrics", "name": "otlphttp/newrelic", "error": "Permanent error: error exporting items, request to https://otlp.nr-dat ││ go.opentelemetry.io/collector/exporter/exporterhelper.(*retrySender).send
```

### Solution
Make sure you're using the correct license key.

## OTel collector pods not created
If you don't see pods related to the OTel collector being created, there's likely an issue with the HelmRelease Custom Resource Definition (CRD). Run the following command to diagnose the problem:

```shell
kubectl get helmrelease open-telemetry -n agent-control
```

If everything went smoothly, you should see `READY` as `True`, and `STATUS` reflecting the current install succeeded.

If there are issues, the `STATUS` field will indicate the problem, and `READY` will be `FALSE`. Depending on the error, it might not be fully reflected in the status. For further insights, run the following command:

```shell
kubectl describe helmrelease open-telemetry -n agent-control
```

## Additional support
If you encounter issues not covered in this section, contact [New Relic support](https://support.newrelic.com).
