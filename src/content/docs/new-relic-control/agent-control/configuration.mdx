---
title: "Configuration"
metaDescription: "Overview of the Agent Control configuration"
freshnessValidatedDate: never
---
<Callout title="preview">
  We're still working on this feature, but we'd love for you to try it out!

  This feature is currently provided as part of a preview program pursuant to our [pre-release policies](/docs/licenses/license-information/referenced-policies/new-relic-pre-release-policy).
</Callout>

The [`values-newrelic.yaml`](https://github.com/newrelic/helm-charts/blob/master/charts/agent-control/values.yaml) file, which traditionally defined agent behavior, now also includes settings for Agent Control. The settings and parameters that you configure in this file define how Agent Control and the agents it manages operate. This file is referred to as the local configuration.

Here's an example configuration:

<CollapserGroup>
  <Collapser
    id="agent-control-config"
    title="Agent Control configuration"
  >

    ```yaml
    global:
      cluster: "YOUR_CLUSTER_NAME"
      licenseKey: "YOUR_LICENSE_KEY"
      userKey: "YOUR_USER_KEY"

    # Values related to the agent control's Helm chart release.
    # `https://github.com/newrelic/helm-charts/blob/master/charts/agent-control/values.yaml`
    agent-control-deployment:
      config:
        fleet_control:
          # Optional: Specify a fleet_id (entity guid) to automatically connect to an existing fleet.
          fleet_id: ""
          auth:
            # New Relic organization ID where agent will connect to.
            organizationId: "YOUR_ORGANIZATION_ID"
        
        # List of managed agents that will be deployed. The key represents the name of the agent and the value holds the configuration.
        subAgents:
          infrastructure:
            type: newrelic/com.newrelic.infrastructure:0.1.0
            content:
              # Ref: `https://github.com/newrelic/helm-charts/tree/master/charts/nri-bundle`
              # Recommended: check and define an explicit chart version (latest stable)
              chart_version: "*"   
              chart_values:
                newrelic-infrastructure:
                enableProcessMetrics: true
          logs:
            type: newrelic/io.fluentbit:0.1.0
            content:
              # Ref: `https://github.com/newrelic/helm-charts/tree/master/charts/newrelic-logging`
              # Recommended: check and define an explicit chart version (latest stable)
              chart_version: "*"
              chart_values:
                newrelic-logging:
                  sendMetrics: true
          agent-operator:
            type: com.newrelic.k8s_agent_operator:0.1.0
            content:
              chart_version: "*"
    ```

  </Collapser>

</CollapserGroup>

The example shows the Agent Control configuration, which includes the settings for the Kubernetes infrastructure agent as well as for Fluent Bit.

For environments with a small number of clusters, managing local configurations is straightforward. For example, if you don't want to send metrics related to the health of your log collector (Fluent Bit, in this case), set `sendMetrics` to `false` in the YAML file, and run the installation command.

However, managing configurations locally becomes impractical in environments with hundreds or thousands of clusters. In such cases, [Fleet Control](/docs/new-relic-control/fleet-control/overview) offers centralized configuration management. Define agent configurations directly in the Fleet Control UI and deploy changes across multiple clusters. This is known as remote configuration.

Agent Control uses `ConfigMaps` in Kubernetes to persist both local and remote configurations. By default, remote configuration overrides local configuration. To revert to local configuration, deploy an empty configuration via Fleet Control. Note that any changes will impact all clusters within the fleet.

To learn about all the settings in the configuration file, refer [`values-newrelic.yaml`](https://github.com/newrelic/helm-charts/blob/master/charts/agent-control/values.yaml).

## Sample configurations
### Local configuration: New Relic infrastructure and Fluent Bit
The following snippet demonstrates installing Agent Control with infrastructure monitoring and Fluent Bit for logs collection:

<CollapserGroup>
  <Collapser
        id="agent-control-config"
        title="Local config for infrastructure and Fluent Bit"
      >
    ```yaml
    global:
      cluster: "YOUR_CLUSTER_NAME"
      licenseKey: "YOUR_LICENSE_KEY"
      userKey: "YOUR_USER_KEY"

    # See `https://github.com/newrelic/helm-charts/blob/master/charts/agent-control/values.yaml`
    agent-control-deployment:
      config:
        fleet_control:
          # Optional
          # fleet_id: YOUR_FLEET_ENTITY_GUID
          auth:
            organizationId: "YOUR_ORGANIZATION_ID"
        subAgents:
          infrastructure:
            type: newrelic/com.newrelic.infrastructure:0.1.0
            content:
              # Ref: `https://github.com/newrelic/helm-charts/tree/master/charts/nri-bundle`
              # Recommended: check and define an explicit chart version (latest stable)
              chart_version: "*"
              
              #chart_values:
              #  newrelic-infrastructure:
              #    enableProcessMetrics: true
          logs:
            type: newrelic/io.fluentbit:0.1.0
            content:
              # Ref: `https://github.com/newrelic/helm-charts/tree/master/charts/newrelic-logging`
              # Recommended: check and define an explicit chart version (latest stable)
              chart_version: "*"

              #chart_values:
              #  newrelic-logging:
              #    sendMetrics: true
          agent-operator:
            type: com.newrelic.k8s_agent_operator:0.1.0
            chart_version: "*"
    ```
  </Collapser>

</CollapserGroup>



### Local configuration: OpenTelemetry
The following snippet demonstrates installing Agent Control with OpenTelemetry and disabling the filelog receiver in the managed [`nr-k8s-otel-collector` Helm chart](https://github.com/newrelic/helm-charts/tree/master/charts/nr-k8s-otel-collector#values):

<CollapserGroup>
  <Collapser
    id="otel-config"
    title="OpenTelemetry configuration"
  >

    ```yaml
        global:
          cluster: "YOUR_CLUSTER_NAME"
          licenseKey: "YOUR_LICENSE_KEY"
        # Values related to the agent control's Helm chart release.
        # `https://github.com/newrelic/helm-charts/blob/master/charts/agent-control/values.yaml`
        agent-control-deployment:
          identityClientId: ""
          identityClientSecret: ""
          config:
            fleet_control:
              # Optional: Specify a fleet_id (entity guid) to automatically connect to an existing fleet.
              fleet_id: ""
              auth:
                # New Relic organization ID where agent will connect to.
               organizationId: "YOUR_ORGANIZATION_ID"
          
            # List of managed agents that will be deployed. The key represents the name of the agent and the value holds the configuration.
           subAgents:
             infrastructure:
               type: newrelic/com.newrelic.infrastructure:0.1.0
               content:
                  # Ref: `https://github.com/newrelic/helm-charts/tree/master/charts/nri-bundle%60 
                  # Recommended: check and define an explicit chart version (latest stable)
                 chart_version: "*"
             agent-operator:
               type: newrelic/com.newrelic.k8s_agent_operator:0.1.0
               content:
                 chart_version: "*"
             fluentbit:
               type: newrelic/io.fluentbit:0.1.0
               content:
                  # Ref: `https://github.com/newrelic/helm-charts/tree/master/charts/newrelic-logging`
                  # Recommended: check and define an explicit chart version (latest stable)
                 chart_version: "*"
                 chart_values:
                   global:
                     lowDataMode: true
             prometheus:
               type: newrelic/com.newrelic.prometheus:0.1.0
               content:
                 chart_version: "*"
                 chart_values:
                   global:
                     lowDataMode: true
                   newrelic-prometheus-agent:
                     config.kubernetes.integrations_filter.enabled: false
    ```

  </Collapser>

</CollapserGroup>

### Remote configuration: New Relic infrastructure


<CollapserGroup>
  <Collapser
    id="infra-remote-config"
    title="Infrastructure remote configuration"
  >

    ```yaml
    chart_version: "*"
      chart_values:
        newrelic-infrastructure:
          enableProcessMetrics: true
    ```

  </Collapser>

</CollapserGroup>

### Remote configuration: Fluent Bit


<CollapserGroup>
  <Collapser
    id="fluentbit-remote-config"
    title="Fluent Bit configuration"
  >

    ```yaml
      chart_version: "*"
      chart_values:
        newrelic-logging:
          sendMetrics: true
    ```

  </Collapser>

</CollapserGroup>

### Remote configuration: Prometheus


<CollapserGroup>
  <Collapser
    id="prometheus-config"
    title="Prometheus configuration"
  >

    ```yaml
      chart_version: "*"
      chart_values:
        newrelic-prometheus-agent:
          lowDataMode: true
    ```

  </Collapser>

</CollapserGroup>

### Remote configuration: OpenTelemetry


<CollapserGroup>
  <Collapser
    id="prometheus-config"
    title="Prometheus configuration"
  >

    <Callout variant="important">
      Create a Kubernetes secret to securely store the New Relic license key and use it in the `chart_values` in replacement of the `licenseKey` value:

          ```yaml
              customSecretName: "your-secret-name"
                customSecretLicenseKey: "your-secret-key"
          ```
    </Callout>

    For this approach, create a configuration in Fleet Control UI with the following structure, specifying the desired `receivers.filelog.enabled` value and referencing any other relevant Helm chart values:
            
          ```yaml
                chart_version: "*"
                chart_values:
                  newrelic-prometheus-agent:
                    lowDataMode: true
          ```

  </Collapser>

</CollapserGroup>