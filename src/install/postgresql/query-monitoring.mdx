---
headingText: Enable query monitoring
componentType: default
---

You can view query-level analysis to monitor your SQL queries within your PostgreSQL database to assess their performance and impact. It provides insights into execution times, resource consumption, and potential bottlenecks, enabling users to optimize database operations. For more information, refer Query-Level Analysis.

**Prerequisites:**

* Ensure that your PostgreSQL version is 12 or higher.
* You must enable the `pg_stat_statements` and `pg_wait_sampling` extension. For more information, refer [Enabling extensions](#enabling-extensions).


### Enabling extensions [#](#enabling-extensions)

1. To install the required packages, in the following command, update the `<version>` with your PostgreSQL version and run:

    ```shell
    sudo apt update && sudo apt install golang-go && sudo apt install gcc && sudo apt install make && sudo apt-get install postgresql-server-dev-<version>
    ```

2. To retrieve the query wait events, install the `pg_wait_sampling` extension by running the following commands:

    ```shell
    git clone https://github.com/postgrespro/pg_wait_sampling.git 
    cd pg_wait_sampling
    sudo make USE_PGXS=1
    sudo make USE_PGXS=1 install
    ```

3. To retrieve the slow queries, install the `pg_stat_monitor` extension by running the following commands:

    ```shell
    git clone https://github.com/postgrespro/pg_wait_sampling.git 
    cd pg_wait_sampling
    sudo make USE_PGXS=1
    sudo make USE_PGXS=1 install
    ```

4. pg_stat_statements extension is responsible for slow running queries

5. Open `postgresql.conf`

    ```shell
    sudo nano /etc/postgresql/<your-version>/main/postgresql.conf
    ```

6. Add extensions to shared_preload_libraries in postgresql.conf
    ```shell
    shared_preload_libraries = 'pg_stat_statements,pg_wait_sampling,pg_stat_monitor'
    pg_stat_statements.max = 10000    # Maximum number of statements tracked
    pg_stat_statements.track = all    # Track all statements
    pg_stat_statements.save = on      # Save statistics across server restarts
    ```

7. Restart Postgresql server
    ```shell
    sudo systemctlÂ restart postgresql
    ```

8. Connect to Postgresql server
    ```shell
    sudo -u postgres psql
    ```

9. Enable extensions in database
    ```shell
    CREATE EXTENSION pg_stat_statements;
    CREATE EXTENSION pg_wait_sampling;
    CREATE EXTENSION pg_stat_monitor;
    ```

10. Grant permissions

    ```shell
    sudo -u postgres psql
    GRANT pg_read_all_stats TO newrelic;
    GRANT SELECT ON ALL TABLES IN SCHEMA public TO your_username;
    ```