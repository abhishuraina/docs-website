---
headingText: Enable query monitoring
componentType: default
---

To obtain query-related metrics, it is essential to enable the following extension: pg_stat_statements

<Callout variant="important">
To enable these extension, PostgreSQL version should be 12 or higher.

pg_stat_monitor and pg_wait_sampling extensions doesnt support windows
</Callout>


1. `pg_stat_statements` extension is responsible for slow running queries and blocking sessions

2. Open `postgresql.conf`

    ```shell
    C:\Program Files\PostgreSQL\<version>\data\postgresql.conf
    ```

6. Add extensions to shared_preload_libraries in `postgresql.conf`
    ```shell
    shared_preload_libraries = 'pg_stat_statements'
    pg_stat_statements.max = 10000    # Maximum number of statements tracked
    pg_stat_statements.track = all    # Track all statements
    pg_stat_statements.save = on      # Save statistics across server restarts
    ```

7. Restart Postgresql server
    ```shell
    net stop postgresql-x64-<version>
    net start postgresql-x64-<version>
    ```

8. Connect to Postgresql server
    ```shell
    psql -U postgres
    ```

9. Enable extensions in database
    ```shell
    CREATE EXTENSION pg_stat_statements;
    ```

10. Grant permissions

    ```shell
    psql -U postgres
    GRANT pg_read_all_stats TO newrelic;
    GRANT SELECT ON ALL TABLES IN SCHEMA public TO your_username;
    ```