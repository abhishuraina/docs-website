---
headingText: Enable query monitoring
componentType: default
---

To obtain query-related metrics, it is essential to enable the following extensions: pg_stat_statements , pg_wait_sampling and pg_stat_monitor

<Callout variant="important">
To enable the pg_stat_statements and pg_stat_monitor extensions, PostgreSQL must be version 12 or higher, while pg_wait_sampling requires PostgreSQL version 13 or higher.
</Callout>

1. Prerequisites

    ```shell
    sudo yum install -y postgresql14-server postgresql<version>-contrib
    ```

2. pg_wait_sampling extension is responsible for query wait events

    ```shell
    sudo dnf install -y pg_wait_sampling_<VERSION>
    ```

3. pg_stat_monitor extension is responsible for individual queries and execution plan details

    ```shell
    sudo dnf install -y pg_stat_monitor_<VERSION>
    ```

4. pg_stat_statements extension is responsible for slow running queries

5. Open `postgresql.conf`

    ```shell
    sudo nano /var/lib/pgsql/<VERSION>/data/postgresql.conf 
    ```

6. Add extensions to shared_preload_libraries in postgresql.conf
    ```shell
    shared_preload_libraries = 'pg_stat_statements,pg_wait_sampling,pg_stat_monitor'
    pg_stat_statements.max = 10000    # Maximum number of statements tracked
    pg_stat_statements.track = all    # Track all statements
    pg_stat_statements.save = on      # Save statistics across server restarts
    ```

7. Restart Postgresql server
    ```shell
    sudo systemctlÂ restart postgresql-<VERSION>.service
    ```

8. Connect to Postgresql server
    ```shell
    sudo -u postgres psql
    ```

9. Enable extensions in database
    ```shell
    CREATE EXTENSION pg_stat_statements;
    CREATE EXTENSION pg_wait_sampling;
    CREATE EXTENSION pg_stat_monitor;
    ```

10. Grant permissions

    ```shell
    sudo -u postgres psql
    GRANT pg_read_all_stats TO newrelic;
    GRANT SELECT ON ALL TABLES IN SCHEMA public TO your_username;
    ```